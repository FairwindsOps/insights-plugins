output:
  title: "This pod could be susceptible to CVE-2020-14386"
  severity: 0.9
  remediation: "Remove the NET_RAW capability"
  category: "Security"
rego: |
        package fairwinds
        dropsNetRaw(pod) {
          keys := {"containers", "initContainers"}
          containers := [c | keys[k]; c = pod.spec[k][_]]
          container = containers[_]
          caps := {"NET_RAW", "ALL"}
          cap := caps[_]
          container.securityContext.capabilities.drop[_] == cap
        }

        cronjob[description] {
          input.kind == "CronJob"
          pod := input.spec.jobTemplate.spec.template
          pod
          !dropsNetRaw(pod)
          description := "Capability NET_RAW found"
        }
        pod[description] {
          input.kind == "Pod"
          !dropsNetRaw(pod)
          description := "Capability NET_RAW found"
        }
        deploymentLike[description] {
          kinds := {"Deployment", "DaemonSet", "StatefulSet", "ReplicaSet", "Job"}
          kind := kinds[_]
          input.kind == kind
          pod := input.spec.template
          pod
          !dropsNetRaw(pod)
          description := "Capability NET_RAW found"
        }
