# Example Kyverno Policy that generates events for policy violations
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: disallow-host-path
  annotations:
    policies.kyverno.io/title: Disallow HostPath Volumes
    policies.kyverno.io/category: Security
    policies.kyverno.io/severity: high
    policies.kyverno.io/description: >-
      Disallows the use of hostPath volumes in Pods for security reasons.
spec:
  validationFailureAction: Audit  # This allows resource creation but generates events
  background: true
  rules:
  - name: disallow-host-path
    match:
      resources:
        kinds:
        - Pod
    validate:
      message: "HostPath volumes are forbidden. The field spec.template.spec.volumes[*].hostPath must be unset."
      pattern:
        spec:
          =(volumes):
            - X(hostPath): "null"
---
# Example Pod that will trigger the policy violation
apiVersion: v1
kind: Pod
metadata:
  name: nginx-with-hostpath
  namespace: default
  labels:
    app: nginx
spec:
  containers:
  - name: nginx
    image: nginx:1.14.2
    ports:
    - containerPort: 80
    volumeMounts:
    - name: host-volume
      mountPath: /host-data
  volumes:
  - name: host-volume
    hostPath:
      path: /data  # This will trigger the policy violation
---
# Example of the event that will be generated:
# Warning   PolicyViolation     deployment/nginx                               policy disallow-host-path/disallow-host-path fail: HostPath volumes are forbidden. The field spec.template.spec.volumes[*].hostPath must be unset.
